<!doctype html>
<meta charset="utf-8">

<head>
  <link rel="icon"
        type="image/png"
        href="favicon.png">
  <link href="https://fonts.googleapis.com/css?family=Open+Sans:300,300i,400,400i,600,600i,700,700i,800,800i" rel="stylesheet">
  <meta name="keywords" content="Luciano Ratamero, lektor, python, site estático, deploy, macros, admin, plugins"/>
  <link rel="stylesheet" href="../../scss/main.css">
  <title>Lektor parte 2: deploy, macros, admin e plugins — luciano@ratamero.com</title>
</head>

<body>
  <div id="content">
    <div class="container-fluid">

      <div class="row">

        <nav class="nav-desktop col-xs-3">
          <div class="flex-wrapper">
            <ul class="social-icons">
              <li>
                <a href="https://twitter.com/lucianoratamero" target="_blank" rel="noopener noreferrer">
                  <svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m31.6 13.6q-1.3 0.6-2.7 0.8 1.5-0.9 2-2.6-1.4 0.8-2.9 1.1-1.4-1.5-3.5-1.5-1.9 0-3.3 1.4t-1.3 3.3q0 0.7 0.1 1.1-2.9-0.2-5.4-1.5t-4.3-3.4q-0.7 1.1-0.7 2.3 0 2.6 2.1 3.9-1.1 0-2.3-0.5v0q0 1.7 1.1 3t2.8 1.6q-0.7 0.2-1.1 0.2-0.3 0-0.9-0.1 0.4 1.4 1.6 2.3t2.8 1q-2.6 2-5.9 2-0.6 0-1.1-0.1 3.3 2.1 7.2 2.1 2.5 0 4.7-0.8t3.7-2.1 2.7-3.1 1.7-3.6 0.5-3.7q0-0.4 0-0.7 1.4-1 2.4-2.4z m5.7-4.3v21.4q0 2.7-1.9 4.6t-4.5 1.8h-21.5q-2.6 0-4.5-1.8t-1.9-4.6v-21.4q0-2.7 1.9-4.6t4.5-1.8h21.5q2.6 0 4.5 1.8t1.9 4.6z"></path></g></svg>
                </a>
              </li>
              <li>
                <a href="https://www.linkedin.com/in/luciano-ratamero-06b98b32/" target="_blank" rel="noopener noreferrer">
                  <svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m8.3 31.6h5.1v-15.5h-5.1v15.5z m5.5-20.3q0-1.2-0.8-1.9t-2.1-0.8-2.1 0.8-0.8 1.9q0 1.1 0.8 1.9t2 0.8h0.1q1.3 0 2.1-0.8t0.8-1.9z m13 20.3h5.2v-8.9q0-3.5-1.6-5.2t-4.3-1.8q-3.1 0-4.7 2.6h0v-2.2h-5.1q0 1.4 0 15.5h5.1v-8.7q0-0.8 0.2-1.2 0.3-0.8 1-1.4t1.7-0.5q2.5 0 2.5 3.5v8.3z m10.5-22.3v21.4q0 2.7-1.9 4.6t-4.5 1.8h-21.5q-2.6 0-4.5-1.8t-1.9-4.6v-21.4q0-2.7 1.9-4.6t4.5-1.8h21.5q2.6 0 4.5 1.8t1.9 4.6z"></path></g></svg>
                </a>
              </li>
              <li>
                <a href="https://github.com/lucianoratamero/" target="_blank" rel="noopener noreferrer">
                  <svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m14.6 26.8q0.1-0.1-0.1-0.3-0.2-0.2-0.3 0-0.1 0.1 0.1 0.2 0.2 0.2 0.3 0.1z m-0.6-0.9q-0.2-0.2-0.3-0.1-0.1 0.1 0 0.3 0.1 0.1 0.3 0.1 0.1-0.1 0-0.3z m-1-0.9q0.1-0.1-0.1-0.2-0.1 0-0.1 0-0.1 0.2 0 0.2 0.2 0.1 0.2 0z m0.5 0.5q0.1 0 0-0.1t0-0.1q-0.2-0.2-0.3-0.1t0.1 0.3q0.1 0.1 0.2 0z m1.9 1.7q0.1-0.2-0.2-0.3-0.2 0-0.3 0.1 0 0.2 0.2 0.3 0.2 0 0.3-0.1z m1 0q0-0.1-0.3-0.1-0.2 0-0.2 0.1t0.2 0.2 0.3-0.2z m0.8-0.1q0-0.2-0.2-0.1t-0.2 0.2q0 0.1 0.2 0.1t0.2-0.2z m14.4-7.1q0-4.7-3.4-8.1t-8.1-3.3-8 3.3-3.4 8.1q0 3.7 2.2 6.7t5.6 4.1q0.4 0.1 0.6-0.1t0.2-0.4q0-1.2 0-2.1-0.1 0-0.4 0t-0.8 0.1-1-0.1-1-0.5-0.7-0.9q-0.5-1.3-1.2-1.6-0.1-0.1-0.1-0.1l-0.2-0.2-0.2-0.2 0.1-0.2 0.5-0.1q0.1 0 0.3 0.1t0.7 0.3 0.7 0.8q0.4 0.7 0.8 1t1 0.3 0.9-0.1 0.6-0.2q0.2-1.1 0.8-1.6-1.1-0.1-1.9-0.4t-1.7-0.8-1.2-1.7-0.5-2.7q0-1.8 1.2-3.1-0.5-1.3 0.1-3 0.5-0.1 1.3 0.2t1.3 0.6l0.6 0.4q1.3-0.4 2.8-0.4t2.9 0.4q0.3-0.2 0.6-0.4t1.3-0.6 1.3-0.2q0.6 1.7 0.1 3 1.1 1.3 1.1 3.1 0 1.3-0.3 2.2t-0.8 1.6-1.2 1-1.3 0.6-1.6 0.2q0.8 0.7 0.8 2.2 0 0.9 0 2t0 1.1q0 0.3 0.2 0.4t0.6 0.1q3.4-1.1 5.6-4.1t2.2-6.7z m5.7-10.7v21.4q0 2.7-1.9 4.6t-4.5 1.8h-21.5q-2.6 0-4.5-1.8t-1.9-4.6v-21.4q0-2.7 1.9-4.6t4.5-1.8h21.5q2.6 0 4.5 1.8t1.9 4.6z"></path></g></svg>
                </a>
              </li>
              <li>
                <a href="http://lastfm.com/user/lucianoratamero" target="_blank" rel="noopener noreferrer">
                  <svg fill="currentColor" preserveAspectRatio="xMidYMid meet" height="1em" width="1em" viewBox="0 0 40 40" style="vertical-align: middle;"><g><path d="m35 23.5q0-3.9-5.3-5.4-0.7-0.2-1.1-0.3t-0.9-0.6-0.6-1q0-0.1-0.1-0.2t0-0.3-0.1-0.1q0-0.8 0.6-1.4t1.3-0.5q1.2 0 1.6 0.3h0q0.4 0.4 0.9 1.2l2-1.6q-0.8-1.2-1.1-1.4-0.7-0.7-1.5-0.9t-1.9-0.2q-1.8 0-3.1 1.3t-1.4 3q0 0.2 0 0.5 0.4 2.2 1.5 3.2t3.3 1.6q0.6 0.2 1.1 0.3t1 0.5 0.8 0.8 0.3 1v0.1q0.1 1.3-0.9 2.1t-2.2 0.8q-2.2 0-3.7-3.2-0.6-1.1-1.2-2.7t-1.1-2.8-1.2-2.5-1.6-2.1-2.3-1.4-3.3-0.5q-2.3 0-4.3 1.2t-3.2 3.3-1.1 4.3v0q0.1 2.4 1.1 4.5t3 3.3 4.4 1.2q4.1 0 6.2-2.4 0.4-0.6 0.7-1.2l-1.4-2.4q-0.9 1.8-2.2 2.6t-3.2 0.8q-2.6 0-4.3-1.9t-1.7-4.6q0-2.3 1.8-4.2t4.2-1.9q2.5 0 3.8 1.2t2.3 3.8q0.2 0.5 0.6 1.6t0.6 1.7 0.7 1.6 0.9 1.7 1 1.4 1.2 1.2 1.5 0.7 1.8 0.3q2.4 0 4.1-1.5t1.7-3.9z m2.3-14.2v21.4q0 2.7-1.9 4.6t-4.5 1.8h-21.5q-2.6 0-4.5-1.8t-1.9-4.6v-21.4q0-2.7 1.9-4.6t4.5-1.8h21.5q2.6 0 4.5 1.8t1.9 4.6z"></path></g></svg>
                </a>
              </li>
              <li>
                <a href="https://twitch.tv/lucianoisstreaming" target="_blank" rel="noopener noreferrer">
                  <!-- icons by FontAwesome! -->
                  <svg aria-hidden="true" data-prefix="fab" data-icon="twitch" class="svg-inline--fa fa-twitch fa-w-14" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path fill="currentColor" d="M40.1 32L10 108.9v314.3h107V480h60.2l56.8-56.8h87l117-117V32H40.1zm357.8 254.1L331 353H224l-56.8 56.8V353H76.9V72.1h321v214zM331 149v116.9h-40.1V149H331zm-107 0v116.9h-40.1V149H224z"></path></svg>

                </a>
              </li>
            </ul>
            <ul class="nav navbar-nav">
              
                <a
                  
                  href="../../blog/"
                >
                  <li>Blog</li>
                </a>
              
                <a
                  
                  href="../../previous-talks/"
                >
                  <li>Talks</li>
                </a>
              
                <a
                  
                    class="no-ajaxy"
                  
                  href="../../sketches"
                >
                  <li>Sketches</li>
                </a>
              
            </ul>
            <h1><a href="../../">luciano@ratamero.com</a></h1>
          </div>
        </nav>

        <div class="col-xs-12 col-lg-9 col-lg-offset-3">
          <div class="page">
            
  
  <div class="blog-post">
  
    <h2 class="page-title">Lektor parte 2: deploy, macros, admin e plugins</h2>
  
  <p class="meta">
    
      Luciano Ratamero
    
    - Wednesday, February 3, 2016
  </p>
  <div class="image-wrapper">
    <a target="_blank" href="https://getlektor.com/"><img src="https://lucianoratamero.github.io/img/cover-lektor-2.png"></a>
</div><p>agora que já expliquei o básico de como utilizar o Lektor pra desenvolver seu site estático, vou começar a explicar alguns aspectos mais avançados. não pretendo ser muito detalhista, mas fiquem a vontade para pedir mais informações nos comentários. aí vai!</p>
<hr>

<h3>deploy</h3>
<p>sim, o Lektor vem pronto para uma série de opções para deploy facilitado: <a href="https://www.getlektor.com/docs/deployment/rsync/">rsync</a>, <a href="https://www.getlektor.com/docs/deployment/ftp/">ftp</a>, <a href="https://www.getlektor.com/docs/deployment/ghpages/">github pages</a> e, via plugin, <a href="https://github.com/spenczar/lektor-s3">s3</a>. isso significa que basta ter um local remoto para manter seus arquivos estáticos que você tem um site pronto, com deploy e tudo.</p>
<p>o deploy dele é facilmente configurado e bem inteligente, já que ele verifica somente os arquivos que precisam ser alterados e os sobrescreve. para configurar, basta seguir <a href="https://www.getlektor.com/docs/deployment/#lektor-assisted-deployments">a documentação</a> do método escolhido e rodar <code>lektor build  lektor deploy</code>. esse processo garante que o Lektor pegará a versão mais nova antes de sincronizar com o servidor.</p>
<p>no meu caso, foi só (juro que foi só isso) colocar o seguinte no meu arquivo de projeto, o <code>blog.lektorproject</code>:</p>
<pre><code>[servers.ghpages]
target = ghpages+https://lucianoratamero/blog</code></pre><p>não cheguei a ver os outros, mas <strong>duvido</strong> que sejam muito mais complicados que isso.</p>
<h3>macros</h3>
<p>quando você tiver brincado o suficiente com os modelos do Lektor, você vai sentir falta de iteradores de template. um exemplo clássico é uma página de resumo dos posts de um blog, como a que eu tenho na home desse aqui.</p>
<p>pra isso, existem as macros. elas são templates com lógicas embutidas. mais fácil de explicar mostrando um exemplo.</p>
<pre><code class="django">{% macro render_blog_post(post, from_index=false) %}
  &lt;div class="blog-post"&gt;
  {% if from_index %}
    &lt;h2&gt;&lt;a href="{{ post|url }}"&gt;{{ post.title }}&lt;/a&gt;&lt;/h2&gt;
  {% else %}
    &lt;h2&gt;{{ post.title }}&lt;/h2&gt;
  {% endif %}
  &lt;p class="meta"&gt;
    {{ post.pub_date }}
  &lt;/p&gt;
  {{ post.body }}
  &lt;/div&gt;
{% endmacro %}</code></pre><p>o papel dessa macro é receber um objeto <code>post</code> e formatá-lo de acordo com o template. ele é usado pelo template de blog da seguinte forma:</p>
<pre><code class="django">{% extends "layout.html" %}
{% from "macros/blog.html" import render_blog_post %}
{% from "macros/pagination.html" import render_pagination %}

{% block title %}
  {% if this.title %}{{ this.title }}{% else %}olar{% endif %}
{% endblock %}

{% block body %}
  {% for child in this.pagination.items %}
    {{ render_blog_post(child, from_index=true) }}
  {% endfor %}

  {{ render_pagination(this.pagination) }}
{% endblock %} </code></pre><p>vemos assim que só é necessário importar a macro criada e passar os objetos corretos. pra saber quais objetos e como usá-los, é só dar uma olhada na documentação da <a href="https://www.getlektor.com/docs/api/db/">API de tratamento de dados</a> do Lektor.</p>
<h3>admin</h3>
<p>ah, sim, o Lektor, quando usado localmente, oferece uma interface administrativa pra edição e criação de conteúdo. pra usá-la, basta rodar o servidor com <code>lektor server</code>, acessar a página <code>localhost:5000</code> e clicar no ícone do lápis do canto da tela.</p>
<div class="image-wrapper">
    <img src="https://lucianoratamero.github.io/img/acessando-o-admin.jpg">
</div><p>isso te levará pra uma página do admin similar à essa:</p>
<div class="image-wrapper">
    <img src="https://lucianoratamero.github.io/img/admin.jpg">
</div><p>todas as alterações feitas nela refletirão nos seus arquivos do projeto e vice-versa. fica na sua preferência utilizar a interface administrativa ou editar os arquivos <code>content.lr</code> diretamente. :) mais um pouco e já poderemos colocar isso na mão dos próprios clientes!</p>
<h3>plugins</h3>
<p>como o Lektor é bem documentado e extensível, ficou fácil pra (pequena) comunidade criar plugins que adicionam novos comportamentos. vocês devem ter notado que uso o disqus como plataforma de comentários, e não tive trabalho quase nenhum pra colocá-lo no blog, quase nenhum <strong>mesmo</strong>.</p>
<p>pra usar um plugin, é só procurar na <a href="https://www.getlektor.com/docs/plugins/">página de plugins do Lektor</a> o plugin que quer usar e seguir a própria documentação. vou demonstrar pra vocês como foi fácil colocar o <a href="https://github.com/lektor/lektor-disqus-comments">plugin de comentários do disqus</a>.</p>
<p>o que eu fiz foi abrir o aquivo <code>blog.lektorproject</code> na raiz do meu projeto (o nome do arquivo varia com o nome do projeto) e colocar as seguintes linhas:</p>
<pre><code>[packages]
lektor-disqus-comments = 0.1</code></pre><p>isso fez com que, quando eu rodasse <code>lektor server</code> ou <code>lektor build</code>, ele detectasse minha intenção, instalasse as dependências e ficasse pronto pra usar o plugin.</p>
<p>depois disso, fui no <a href="https://publishers.disqus.com/engage?utm_source=Home-Nav">disqus</a> e criei uma comunidade pro blog (é bem autoexplicativo o processo, não me demorou dois minutos).</p>
<p>com o nome da comunidade em mãos, criei uma pasta <code>configs/</code> na raiz do projeto com um arquivo <code>disqus-comments.ini</code> dentro. nesse arquivo, só precisei declarar o shortname da comunidade.</p>
<pre><code>shortname = lucianoratamerosblog</code></pre><p>com o disqus configurado, escolhi o template de blog-post pra habilitar os comentários e os coloquei assim:</p>
<pre><code class="django">{% extends "layout.html" %}
{% from "macros/blog.html" import render_blog_post %}
{% block title %}{{ this.title }}{% endblock %}
{% block tags %}{{ this.tags }}{% endblock %}
{% block body %}
  {{ render_blog_post(this) }}
  <div class="comments">{{ render_disqus_comments() }}</div>
{% endblock %} </code></pre><p>só precisei botar mesmo a div de comentários. daí foi recarregar a página e voilá, tudo funcionando <strong>lindamente</strong>.</p>
<hr>

<p>enfim, espero ter abordado um pouco melhor alguns detalhes e features interessantes do Lektor. caso tenham alguma pergunta ou dúvida, só mandarem ver nos comentários. é isso por enquanto, minha gente, vejo vocês na próxima! o/</p>

  </div>


  <div class="comments">
<div id="disqus_thread"></div>
<script>
  var disqus_config = function() { this.page.identifier = "/blog/lektor-parte-2-deploy-macros-admin-e-plugins"; };
  (function() {
    var d = document, s = d.createElement('script');
    s.src = '//lucianoratamerosblog.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
  })();
</script>
<noscript>
  Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript"
    rel="nofollow">comments powered by Disqus.</a>
</noscript>
</div>

          </div>
        </div>

      </div>

      <nav class="nav-mobile">
        <h1><a href="../../">luciano@ratamero.com</a></h1>
        <ul class="nav navbar-nav">
          
            <a
              
              href="../../blog/"
            >
              <li>Blog</li>
            </a>
          
            <a
              
              href="../../previous-talks/"
            >
              <li>Talks</li>
            </a>
          
            <a
              
                class="no-ajaxy"
              
              href="../../sketches"
            >
              <li>Sketches</li>
            </a>
          
        </ul>
      </nav>
    </div>

  </div>
  <div class="lds-ripple"><div></div><div></div></div>
  <script src="../../js/main.js"></script>
</body>
